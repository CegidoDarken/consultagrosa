<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/templatemo.min.css">
    <link rel="stylesheet" href="/css/custom.css">
    <link href="/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <title>Consultagro S.A</title>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light shadow">
        <div class="container-fluid d-flex justify-content-between align-items-center">

            <a class="navbar-brand text-success logo align-self-start text-uppercase" href="">
                Consultagro S.A
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                data-bs-target="#templatemo_main_nav" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between"
                id="templatemo_main_nav">
                <div class="flex-fill">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-lg-auto">
                        <li class="nav-item">
                            <a class="nav-link" href=""><i class="bi bi-question-circle-fill"></i> Acerca de
                                nosotros</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/" style="color: #59ab6e;"><i class="bi bi-bag-fill"></i>
                                Tienda</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href=""><i class="bi bi-telephone-fill"></i> Contactanos</a>
                        </li>
                    </ul>
                </div>
                <ul class="navbar-nav">
                    <% if (credentials) { %>
                        <li class="nav-item ">
                            <a href="" class="nav-link dropdown-toggle" data-bs-toggle="modal" data-bs-target="#Cart">
                                <svg class="icon" width="20" height="20" fill="currentColor">
                                    <use xlink:href="/icons/bootstrap-icons.svg#cart" />
                                </svg> Carrito
                            </a>
                        </li>
                        <li class="nav-item">
                            <div class="dropdown">
                                <a href="" class="nav-link dropdown-toggle" id="dropdown" data-bs-toggle="dropdown">
                                    <svg class="icon" width="20" height="20" fill="currentColor">
                                        <use xlink:href="/icons/bootstrap-icons.svg#person-circle" />
                                    </svg>
                                    <%= credentials.nombre %>
                                </a>
                                <ul class="dropdown-menu text-small m-1 bg-body-tertiary" aria-labelledby="dropdown">
                                    <li><a class="dropdown-item" href="#">
                                            <svg class="icon" width="20" height="20" fill="currentColor">
                                                <use xlink:href="/icons/bootstrap-icons.svg#gear" />
                                            </svg> Configuración</a></li>
                                    <li>
                                        <a class="dropdown-item" href="#"><i class="bi bi-person-fill"></i> Perfil
                                        </a>
                                    </li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="" data-bs-toggle="modal"
                                            data-bs-target="#logoutModal">
                                            <svg class="icon" width="20" height="20" fill="currentColor">
                                                <use xlink:href="/icons/bootstrap-icons.svg#box-arrow-right" />
                                            </svg> Cerrar sesión
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <% } else { %>
                            <li class="nav-item">
                                <button class="nav-link" onclick="login()"><i class="bi bi-person-fill"></i> Iniciar
                                    sesión</>
                            </li>
                            <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row">
            <div class="col-lg-3">
                <h2 class="h2 pb-4"><i class="bi bi-ui-checks-grid"></i> Categorias</h2>
                <div class="row">
                    <div class="dropdown col-md-2">
                        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Tipos
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Nutrientes</a></li>
                            <li><a class="dropdown-item" href="#">Fungicidas</a></li>
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Medidas
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Litros</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Kilogramos</a></li>
                        </ul>
                    </div>
                </div>

            </div>

            <div class="col-lg-9">
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-inline shop-top-menu pb-3 pt-1">
                            <li class="list-inline-item">
                                <a class="h3 text-dark text-decoration-none mr-3" href="#"
                                    style="color: #59ab6e !important;">Todos</a>
                            </li>
                            <li class="list-inline-item">
                                <a class="h3 text-dark text-decoration-none mr-3" href="#">Más vendidos</a>
                            </li>
                            <li class="list-inline-item">
                                <a class="h3 text-dark text-decoration-none" href="#">Ofertas</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6 pb-4">
                        <div class="d-flex">
                            <div class="input-group mb-3">
                                <input type="search" class="form-control" placeholder="Buscar" id="search">
                                <span class="input-group-text" id="inputGroup-sizing-default">
                                    <i class="bi bi-search"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="list">
                    <% if (results) { %>
                        <% results.forEach(value=> { %>
                            <div class="col-md-4 content">
                                <div class="card mb-4 product-wap rounded-3 shadow border-0">
                                    <div class="card rounded-3 border-0">
                                        <img class="card-img rounded-3 img-fluid border-0"
                                            data-src="<%= value.img? value.img : '/img/no-image-icon.png' %>" style=" width: 100%;
                                            height: 300px;
                                            object-fit: contain;
                                            object-position: bottom;">
                                        <div
                                            class="card-img-overlay rounded-0 product-overlay d-flex align-items-center justify-content-center">
                                            <ul class="list-unstyled">
                                                <li><a class="btn btn-success text-white" href=""><i
                                                            class="bi bi-cart-plus-fill"></i></a></li>
                                                <li><a class="btn btn-success text-white mt-2" href=""><i
                                                            class="bi bi-eye-fill"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <a class="h3 text-decoration-none" id="nombre">
                                            <%= value.nombre %> <span class="badge" style="background-color: #59ab6e;">
                                                    <%= value.categoria %>
                                                </span>
                                        </a>
                                        <a class="h3 text-decoration-none d-flex text-center">
                                            <p class="m-1 ms-0">Medidas:</p>
                                            <% if(value.medidas){ %>
                                                <% const medidasArray=value.medidas.split('/'); %>
                                                    <% medidasArray.forEach((medida, index)=> { %>
                                                        <span class="badge m-1" id="medida<%= index + 1 %>" style="background-color: #59ab6e;">
                                                            <%= medida %>
                                                        </span>
                                                        <% }); %>
                                                        <% } %>
                                        </a>
                                        <p class="fw-bold mb-0">$<%= value.precio %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                                <% }; %>
                                    <div id="noResultsMessage" style="display: none;">No se han encontrado resultados.
                                    </div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="pagination justify-content-center pagination-sm">
            </ul>
        </nav>
    </div>

    <footer class="bg-dark" id="tempaltemo_footer">
        <div class="container">
            <div class="row">

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-success border-bottom pb-3 border-light logo text-uppercase">Consultagro S.A</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li>
                            <i class="fas fa-map-marker-alt fa-fw"></i>
                            Avenida Juan X Marcos & Olmedo, Babahoyo
                        </li>
                        <li>
                            <i class="fa fa-phone fa-fw"></i>
                            <a class="text-decoration-none" href="tel:05-2570884">05-2570884</a>
                        </li>
                        <li>
                            <i class="fa fa-envelope fa-fw"></i>
                            <a class="text-decoration-none"
                                href="mailto:consultagro.cia@gmail.com">consultagro.cia@gmail.com</a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-light border-bottom pb-3 border-light">Productos</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li><a class="text-decoration-none" href="#">Fungicidas</a></li>
                        <li><a class="text-decoration-none" href="#">Nutrientes</a></li>
                    </ul>
                </div>

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-light border-bottom pb-3 border-light">Información</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li><a class="text-decoration-none" href="#">Acerca de Nosotros</a></li>
                        <li><a class="text-decoration-none" href="#">Contactanos</a></li>
                    </ul>
                </div>

            </div>

            <div class="row text-light">
                <div class="col-12 mb-3">
                    <div class="w-100 my-3 border-top border-light"></div>
                </div>
                <div class="col-auto me-auto">
                    <ul class="list-inline text-left footer-icons">
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="http://facebook.com/"><i
                                    class="fab fa-facebook-f fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank"
                                href="https://www.instagram.com/"><i class="fab fa-instagram fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="https://twitter.com/"><i
                                    class="fab fa-twitter fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank"
                                href="https://www.linkedin.com/"><i class="fab fa-linkedin fa-lg fa-fw"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/templatemo.min.js"></script>
    <script src="/js/custom.js"></script>
    <script>

        $('#search').on('input', filterRows);
        if ("IntersectionObserver" in window) {
            const images = document.querySelectorAll("img");
            let observer = new IntersectionObserver(
                (entries, observer) => {
                    entries.forEach((entry) => {
                        if (!entry.isIntersecting) return;
                        const image = entry.target;
                        const newURL = image.getAttribute("data-src");
                        image.src = newURL;
                        observer.unobserve(image);
                    });
                },
                {
                    threshold: [0.2]
                }
            );

            images.forEach((image) => {
                observer.observe(image);
            });
        }

        function getPageList(totalPages, page, maxLength) {
            if (maxLength < 5) throw "maxLength must be at least 5";

            function range(start, end) {
                return Array.from(Array(end - start + 1), (_, i) => i + start);
            }

            var sideWidth = maxLength < 9 ? 1 : 2;
            var leftWidth = (maxLength - sideWidth * 2 - 3) >> 1;
            var rightWidth = (maxLength - sideWidth * 2 - 2) >> 1;
            if (totalPages <= maxLength) {
                return range(1, totalPages);
            }
            if (page <= maxLength - sideWidth - 1 - rightWidth) {
                return range(1, maxLength - sideWidth - 1)
                    .concat([0])
                    .concat(range(totalPages - sideWidth + 1, totalPages));
            }
            if (page >= totalPages - sideWidth - 1 - rightWidth) {
                return range(1, sideWidth)
                    .concat([0])
                    .concat(
                        range(totalPages - sideWidth - 1 - rightWidth - leftWidth, totalPages)
                    );
            }
            // Breaks on both sides
            return range(1, sideWidth)
                .concat([0])
                .concat(range(page - leftWidth, page + rightWidth))
                .concat([0])
                .concat(range(totalPages - sideWidth + 1, totalPages));
        }

        var numberOfItems = $("#list .content").length;
        var limitPerPage = 12;
        var totalPages = Math.ceil(numberOfItems / limitPerPage);
        var paginationSize = 7;
        var currentPage;

        function showPage(whichPage) {
            if (whichPage < 1 || whichPage > totalPages) return false;
            currentPage = whichPage;
            $("#list .content")
                .hide()
                .slice((currentPage - 1) * limitPerPage, currentPage * limitPerPage)
                .show();
            $(".pagination li").slice(1, -1).remove();
            getPageList(totalPages, currentPage, paginationSize).forEach(item => {
                $("<li>")
                    .addClass(
                        "page-item " +
                        (item ? "current-page " : "") +
                        (item === currentPage ? "active " : "")
                    )
                    .append(
                        $("<a>")
                            .addClass("page-link")
                            .attr({
                                href: "javascript:void(0)"
                            })
                            .text(item || "...")
                    )
                    .insertBefore("#next-page");
            });
            return true;
        }
        $(".pagination").append(
            $("<li>").addClass("page-item").attr({ id: "previous-page" }).append(
                $("<a>")
                    .addClass("page-link")
                    .attr({
                        href: "javascript:void(0)"
                    })
                    .text("Anterior")
            ),
            $("<li>").addClass("page-item").attr({ id: "next-page" }).append(
                $("<a>")
                    .addClass("page-link")
                    .attr({
                        href: "javascript:void(0)"
                    })
                    .text("Siguiente")
            )
        );
        $("#list").show();
        showPage(1);
        $(document).on("click", ".pagination li.current-page:not(.active)", function () {
            return showPage(+$(this).text());
        });
        $("#next-page").on("click", function () {
            return showPage(currentPage + 1);
        });

        $("#previous-page").on("click", function () {
            return showPage(currentPage - 1);
        });
        $(".pagination").on("click", function () {
            $("html,body").animate({ scrollTop: 0 }, 0);
        });
        function filterRows() {
            let query = $.trim($('#search').val().toUpperCase());
            if (query.length === 0) {
                setTimeout(() => {
                    showPage(currentPage);
                }, 1000);
            } else {
                let found = false;
                $('div.content').each(async function () {
                    let nombre = $(this).closest('.content').find('#nombre').text().trim().toUpperCase();
                    if (nombre.indexOf(query) !== -1) {
                        $(this).closest('div.content').fadeIn();
                        found = true;
                    } else {
                        $(this).closest('div.content').fadeOut();
                    }
                });

                if (!found) {
                    $('#noResultsMessage').fadeIn();
                } else {
                    $('#noResultsMessage').fadeOut();
                }
            }
        }
    </script>
</body>

</html>