<!DOCTYPE html>
<html lang="en">

<head>
    <title>Inventario</title>
</head>
<style>
    .fl-table {
        border-radius: 5px;
        font-size: 12px;
        font-weight: normal;
        border: none;
        border-collapse: collapse;
        width: 100%;
        max-width: 100%;
        white-space: nowrap;
        background-color: white;
    }

    .fl-table td,
    .fl-table th {
        text-align: center;
        padding: 8px;
    }

    .fl-table td {
        border-right: 1px solid #f8f8f8;
        font-size: 12px;
    }


    .fl-table tr:nth-child(even) {
        background: #F8F8F8;
    }

    /* Responsive */

    @media (max-width: 1010px) {
        .fl-table {
            display: block;
            width: 100%;
        }

        .table-wrapper:before {
            content: "Scroll horizontally >";
            display: block;
            text-align: right;
            font-size: 11px;
            color: white;
            padding: 0 0 10px;
        }

        .fl-table thead,
        .fl-table tbody,
        .fl-table thead th {
            display: block;
        }

        .fl-table thead th:last-child {
            border-bottom: none;
        }

        .fl-table thead {
            float: left;
        }

        .fl-table tbody {
            width: auto;
            position: relative;
            overflow-x: auto;
        }

        .fl-table td,
        .fl-table th {
            padding: 20px .625em .625em .625em;
            height: 60px;
            vertical-align: middle;
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: auto;
            width: 120px;
            font-size: 13px;
            text-overflow: ellipsis;
        }

        .fl-table thead th {
            text-align: left;
            border-bottom: 1px solid #f7f7f9;
        }

        .fl-table tbody tr {
            display: table-cell;
        }

        .fl-table tbody tr:nth-child(odd) {
            background: none;
        }

        .fl-table tr:nth-child(even) {
            background: transparent;
        }

        .fl-table tr td:nth-child(odd) {
            background: #F8F8F8;
            border-right: 1px solid #E6E4E4;
        }

        .fl-table tr td:nth-child(even) {
            border-right: 1px solid #E6E4E4;
        }

        .fl-table tbody td {
            display: block;
            text-align: center;
        }
    }
</style>

<body>
    <%- include("partials/_headerpanel") %>
        <%- include("partials/_sidebarpanel") %>
            <main id="main" class="main">

                <div class="pagetitle">
                    <h1>Kardex</h1>
                    <nav>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/admin">Inicio</a></li>
                            <li class="breadcrumb-item">Reportes</li>
                            <li class="breadcrumb-item active">Kardex</li>
                        </ol>
                    </nav>
                </div>

                <section class="section">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header row">
                                    <div class="col-md-12 mb-4">
                                        <div class="form-floating">
                                            <select class="form-select form-select-sm" id="productos">
                                                <% if (productos) { %>
                                                    <% productos.forEach(row=> { %><option
                                                            value="<%= row.id_producto %>" }>
                                                            Codigo: <%= row.codigo %> | Nombre: <%= row.nombre %>
                                                        </option>
                                                        <% }); %>
                                                            <% } %>
                                            </select>
                                            <label for="floatingSelect">Productos</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="search" placeholder="Buscar"
                                                value="">
                                            <span class="input-group-text" id="basic-addon1"><i
                                                    class="bi bi-search"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="container-fluid mt-2">
                                        <div class="table-wrapper">
                                            <table
                                                class="fl-table table table-sm table-hover text-center fl-table tablesort w-100"
                                                id="datatable">
                                                <thead>
                                                    <tr class="text-light" style="background-color: #59ab6e;">
                                                        <th colspan="2"></th>
                                                        <th colspan="3" class="text-light">ENTRADAS</th>
                                                        <th colspan="3" class="text-light">SALIDAS</th>
                                                        <th colspan="3" class="text-light">EXISTECIAS</th>
                                                    </tr>
                                                    <tr class="text-light" style="background-color: #59ab6e;">
                                                        <th>FECHA</th>
                                                        <th>DETALLE</th>
                                                        <th>CANTIDAD</th>
                                                        <th>PRECIO UNIDAD</th>
                                                        <th>PRECIO TOTAL</th>
                                                        <th>CANTIDAD</th>
                                                        <th>PRECIO UNIDAD</th>
                                                        <th>PRECIO TOTAL</th>
                                                        <th>CANTIDAD</th>
                                                        <th>PRECIO UNIDAD</th>
                                                        <th>PRECIO TOTAL</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>
            </main>
            <div class="modal fade" id="tag" tabindex="-1" aria-labelledby="exampleModalLabel" arhide="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Asignar</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form id="formtag">
                            <div class="modal-body">
                                <label for="" class="form-label">Producto</label>
                                <input type="text" class="form-control mb-2" id="productoinput" readonly>
                                <label for="" class="form-label">Tag</label>
                                <input id="taginput" type="number" name="tag" class="form-control mb-2"
                                    placeholder="Ingrese un Tag" readonly>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">Cancelar</button>
                                <button type="submit" class="btn btn-primary" id="asignar">Asignar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="delete_producto" tabindex="-1" aria-labelledby="exampleModalLabel"
                arhide="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Eliminar producto</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">¿Estás seguro de que deseas eiminar este producto?</div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button class="btn btn-danger" id="eliminar">Eliminar</button>
                        </div>
                    </div>
                </div>
            </div>
            <%- include("partials/_fotterpanel") %>
                <script>
                    $(document).ready(function () {
                        var tabla = $('#datatable').DataTable({
                            ajax: {
                                url: '/obtener_kardex',
                                type: 'POST',
                                data: function (d) {
                                    d.id_producto = $("#productos").val()
                                },
                                dataSrc: 'data'
                            },
                            columns: [
                                { data: 'fecha', defaultContent: "-" },
                                { data: 'detalle', defaultContent: "-" },
                                { data: 'ecantidad', defaultContent: "-" },
                                { data: 'eunidad', defaultContent: "-" },
                                { data: 'etotal', defaultContent: "-" },
                                { data: 'scantidad', defaultContent: "-" },
                                { data: 'sunidad', defaultContent: "-" },
                                { data: 'stotal', defaultContent: "-" },
                                { data: 'icantidad', defaultContent: "-" },
                                { data: 'iunidad', defaultContent: "-" },
                                { data: 'itotal', defaultContent: "-" }
                            ],
                            "language": {
                                "sEmptyTable": "No hay datos disponibles en la tabla",
                                "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                                "sInfoEmpty": "Mostrando 0 a 0 de 0 entradas",
                                "sInfoFiltered": "(Filtrado de _MAX_ entradas totales)",
                                "sInfoPostFix": "",
                                "sInfoThousands": ",",
                                "sLengthMenu": "Mostrar _MENU_ entradas",
                                "sLoadingRecords": "Cargando...",
                                "sProcessing": "Procesando...",
                                "sSearch": "Buscar:",
                                "sZeroRecords": "No se encontraron resultados",
                                "oPaginate": {
                                    "sFirst": "Primero",
                                    "sLast": "Último",
                                    "sNext": "Siguiente",
                                    "sPrevious": "Anterior"
                                },
                                "oAria": {
                                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                                },
                                "buttons": {
                                    "copy": "Copiar",
                                    "colvis": "Visibilidad"
                                }
                            }
                        });
                        $("#datatable_filter").hide();
                        $('#search').keyup(function () {
                            table = $('.tablesort').DataTable();
                            table.search($(this).val()).draw();
                        });
                        $('#actualizar').click(async function () {
                            await table.ajax.reload()
                        });
                        $('#productos').change(function () {
                            tabla.ajax.reload();
                        });
                    });

                </script>

</body>

</html>